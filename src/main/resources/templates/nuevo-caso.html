<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de seguimiento del alumnado</title>
    <link rel="icon" href="/logotipo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-primary: #8B7355;
            --color-secondary: #A89B8C;
            --color-accent: #B8A080;
            --color-dark: #4A4A4A;
            --color-light: #F5F3F0;
            --color-white: #FFFFFF;
            --color-shadow: rgba(139, 115, 85, 0.25);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F5F3F0 0%, #E8E4DE 100%);
            min-height: 100vh;
            padding: 30px;
        }

        .container {
            max-width: 950px;
            margin: auto;
            background: var(--color-white);
            border-radius: 22px;
            box-shadow: 0 20px 60px var(--color-shadow);
            padding: 40px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            color: var(--color-primary);
            font-size: 2.4em;
            margin-bottom: 35px;
        }

        h2 {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 1.4em;
            margin-bottom: 20px;
        }

        .section {
            background: #FAF8F6;
            padding: 25px;
            border-radius: 14px;
            margin-bottom: 30px;
            border-left: 6px solid var(--color-primary);
        }

        .field-group {
            margin-bottom: 20px;
        }

        label, strong {
            font-weight: 600;
            color: var(--color-dark);
            margin-bottom: 6px;
            display: block;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 12px 14px;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.15);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .checkbox-group label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .fecha-group input {
            max-width: 220px;
        }

        hr {
            border: none;
            height: 2px;
            background: linear-gradient(to right, var(--color-primary), var(--color-secondary));
            margin: 40px 0;
            border-radius: 2px;
        }

        .paso-badge {
            background: var(--color-accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        button[type="submit"],
        .btn-back {
            padding: 14px 38px;
            font-size: 1.05em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        button[type="submit"] {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            box-shadow: 0 6px 16px var(--color-shadow);
        }

        button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px var(--color-shadow);
        }

        .btn-back {
            background: #6b6b6b;
            color: white;
        }

        .btn-back:hover {
            background: #5a5a5a;
        }

        input[required] {
            border-left: 4px solid #c49a6c;
        }

        input[required]:valid {
            border-left: 4px solid #7aa874;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Registro de Seguimiento del Alumnado</h1>

    <form th:action="@{/alumnado/guardar}"
          th:object="${formulario}"
          method="post">

        <!-- Campo oculto para el ID (necesario para ediciones) -->
        <input type="hidden" th:field="*{id}"/>

        <div class="section identification">
            <h2>üîç Identificaci√≥n</h2>

            <div class="field-group">
                <label for="idCaso">ID Caso:</label>
                <input type="text" th:field="*{idCaso}" id="idCaso" placeholder="Ingrese el ID del caso">
            </div>

            <div class="field-group">
                <label for="idDocumento">ID Documento f√≠sico: *</label>
                <input type="number" th:field="*{idDocumento}" id="idDocumento" required
                       placeholder="N√∫mero de documento f√≠sico">
            </div>
        </div>

        <hr>


        <div class="section">
            <h2>PASO 1 <span class="paso-badge">Anexo I</span></h2>

            <p><strong>Anexo I:</strong> Modelo de registro y comunicaci√≥n al Equipo Directivo de la detecci√≥n de la
                conducta de riesgo.</p>

            <!-- Identificador an√≥nimo del alumno -->
            <div class="field-group">
                <label>C√≥digo anonimizado del alumno/a:</label>
                <input type="text" th:field="*{paso1DTO.codigoAlumno}" placeholder="Ej: ALU-2024-001" required>
            </div>

            <!-- Motivo de detecci√≥n -->
            <div class="field-group">
                <label>La conducta de riesgo se detecta por:</label>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.familiaComunica}">
                        Comunicaci√≥n por parte de la familia.
                    </label>

                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.companerosComunican}">
                        Comunicaci√≥n por compa√±eros/as.
                    </label>

                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.alumnoComunica}">
                        El alumno/a comunica su sufrimiento o ideaci√≥n.
                    </label>

                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.intentoPrevio}">
                        Intento autol√≠tico previo y reincorporaci√≥n al centro.
                    </label>

                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.conductaAutolesiva}">
                        Detecci√≥n de conducta autolesiva por la comunidad educativa.
                    </label>

                    <label>
                        <input type="checkbox" th:field="*{paso1DTO.otrosMotivo}">
                        Otras circunstancias.
                    </label>
                </div>
            </div>

            <!-- Campo adicional si se marca "otros" -->
            <div class="field-group">
                <label>Si marc√≥ "Otras", especifique:</label>
                <input type="text" th:field="*{paso1DTO.otrosDetalle}" placeholder="Especificar otras circunstancias">
            </div>

            <!-- Detalle de los hechos -->
            <div class="field-group">
                <label>Detalle de los hechos (breve descripci√≥n):</label>
                <textarea th:field="*{paso1DTO.detalleHechos}" rows="4"
                          placeholder="Describa brevemente la situaci√≥n detectada"
                          required></textarea>
            </div>

            <!-- Fecha -->
            <div class="field-group fecha-group">
                <label>üìÖ Fecha de registro</label>
                <input type="date"
                       th:field="*{paso1DTO.fechaRegistro}"
                       required>
            </div>

            <!-- Firma -->
            <div class="field-group">
                <label>Firma(s) del personal responsable:</label>
                <input type="text" th:field="*{paso1DTO.firmas}" placeholder="Nombre del personal responsable">
            </div>

        </div>


        <div class="section paso-2">
            <h2>PASO 2 <span class="paso-badge">M√∫ltiples Acciones</span></h2>

            <div class="field-group">
                <strong>Constituci√≥n del EA</strong>
                <input type="text" th:field="*{paso2DTO.paso2_1}" placeholder="Detalles de la constituci√≥n del EA">
            </div>

            <div class="field-group">
                <strong>Acta con medidas inmediatas</strong>
                <input type="text" th:field="*{paso2DTO.paso2_2}" placeholder="Medidas inmediatas adoptadas">
            </div>

            <div class="field-group">
                <strong>Informar a familia</strong>
                <input type="text" th:field="*{paso2DTO.paso2_3}"
                       placeholder="Fecha/Confirmaci√≥n de informaci√≥n a familia">
            </div>

            <div class="field-group">
                <strong>Informar a Inspecci√≥n</strong>
                <input type="text" th:field="*{paso2DTO.paso2_4}"
                       placeholder="Fecha/Confirmaci√≥n de informaci√≥n a Inspecci√≥n">
            </div>

            <div class="field-group">
                <strong>Informar a la CPAyC</strong>
                <input type="text" th:field="*{paso2DTO.paso2_5}"
                       placeholder="Fecha/Confirmaci√≥n de informaci√≥n a CPAyC">
            </div>

            <div class="field-group">
                <strong>Cronograma ‚Äì Anexo II</strong>
                <p>(Cronograma de actuaciones durante todo el Protocolo)</p>

                <table class="cronograma-table">
                    <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Situaci√≥n</th>
                        <th>Actuaci√≥n</th>
                        <th>Documento generado</th>
                        <th>Observaciones</th>
                    </tr>
                    </thead>
                    <tbody id="cronogramaBody">


                    <tr th:each="fila, stat : *{paso2DTO.cronograma}">
                        <td><input type="date" th:field="*{paso2DTO.cronograma[__${stat.index}__].fecha}"
                                   class="input-fecha-tabla"></td>
                        <td><input type="text" th:field="*{paso2DTO.cronograma[__${stat.index}__].situacion}"
                                   class="input-tabla"></td>
                        <td><input type="text" th:field="*{paso2DTO.cronograma[__${stat.index}__].actuacion}"
                                   class="input-tabla"></td>
                        <td><input type="text" th:field="*{paso2DTO.cronograma[__${stat.index}__].documento}"
                                   class="input-tabla"></td>
                        <td><input type="text" th:field="*{paso2DTO.cronograma[__${stat.index}__].observaciones}"
                                   class="input-tabla"></td>
                    </tr>

                    </tbody>
                </table>

                <button type="button" class="btn-add-row" onclick="agregarFila()">‚ûï A√±adir fila</button>

            </div>

            <script>
                function agregarFila() {
                    const tbody = document.getElementById("cronogramaBody");
                    const index = tbody.rows.length;
                    const row = tbody.insertRow();

                    row.innerHTML = `
            <td><input type="date" name="paso2DTO.cronograma[${index}].fecha" class="input-fecha-tabla"></td>
            <td><input type="text" name="paso2DTO.cronograma[${index}].situacion" class="input-tabla"></td>
            <td><input type="text" name="paso2DTO.cronograma[${index}].actuacion" class="input-tabla"></td>
            <td><input type="text" name="paso2DTO.cronograma[${index}].documento" class="input-tabla"></td>
            <td><input type="text" name="paso2DTO.cronograma[${index}].observaciones" class="input-tabla"></td>
            `;
                }
            </script>


            <div class="field-group">
                <strong>Antiguo Anexo I</strong>
                <input type="text" th:field="*{paso2DTO.paso2_7}" placeholder="Referencia al antiguo Anexo I">
            </div>
        </div>

        <div class="section">
            <h2>PASO 3</h2>
            <div class="field-group">
                <strong>EA: acta con medidas provisionales adoptadas</strong>
                <textarea th:field="*{paso3_1}"
                          placeholder="EA: acta con medidas provisionales adoptadas"></textarea>
            </div>
        </div>
        <div class="section">
            <h2>PASO 4 <span class="paso-badge">Anexo III</span></h2>

            <p>
                <strong>Anexo III:</strong> Acta de la reuni√≥n del Director/a con la familia.
            </p>

            <!-- Asistentes -->
            <div class="field-group">
                <label>üë• Asistentes a la reuni√≥n</label>
                <input type="text"
                       th:field="*{paso4DTO.asistentes}"
                       placeholder="Director/a, tutor/a, orientador/a, madre, padre‚Ä¶"
                       required>
            </div>

            <!-- Fecha -->
            <div class="field-group fecha-group">
                <label>üìÖ Fecha de la reuni√≥n</label>
                <input type="date"
                       th:field="*{paso4DTO.fecha}"
                       required>
            </div>

            <!-- Contenido tratado -->
            <div class="field-group">
                <label>üìù Contenido de la reuni√≥n</label>
                <textarea
                        th:field="*{paso4DTO.contenido}"
                        placeholder="Informaci√≥n trasladada a la familia, situaci√≥n del alumno/a, explicaciones dadas‚Ä¶"
                        required></textarea>
            </div>

            <!-- Acuerdos alcanzados -->
            <div class="field-group">
                <label>‚úÖ Acuerdos adoptados</label>
                <textarea
                        th:field="*{paso4DTO.acuerdos}"
                        placeholder="Compromisos de la familia, medidas acordadas, seguimiento‚Ä¶"
                        required></textarea>
            </div>
        </div>
        <div class="section">
            <h2>PASO 5 <span class="paso-badge">Anexo IV ‚Äì S√≠ntesis</span></h2>

            <p>
                <strong>Anexo IV:</strong> S√≠ntesis de las entrevistas mantenidas con la familia y con el alumno/a.
            </p>

            <!-- S√çNTESIS CON LA FAMILIA -->
            <div class="field-group">
                <label>üìù S√≠ntesis de la entrevista con la familia</label>
                <textarea
                        th:field="*{paso5DTO.anexo4.sintesisfamilia}"
                        placeholder="Resumen de la informaci√≥n aportada por la familia, valoraci√≥n realizada, contexto‚Ä¶"
                        required></textarea>
            </div>

            <div class="field-group">
                <label>üë• Integrantes que participan (familia)</label>
                <input type="text"
                       th:field="*{paso5DTO.anexo4.integrantesfamilia}"
                       placeholder="Madre, padre, tutor/a legal‚Ä¶"
                       required>
            </div>

            <div class="field-group fecha-group">
                <label>üìÖ Fecha de la entrevista con la familia</label>
                <input type="date"
                       th:field="*{paso5DTO.anexo4.fechafamilia}"
                       required>
            </div>

            <hr>

            <!-- S√çNTESIS CON EL ALUMNO -->
            <div class="field-group">
                <label>üìù S√≠ntesis de la entrevista con el alumno/a</label>
                <textarea
                        th:field="*{paso5DTO.anexo4.sintesisalumno}"
                        placeholder="Resumen de lo expresado por el alumno/a, estado emocional, percepci√≥n del problema‚Ä¶"
                        required></textarea>
            </div>

            <div class="field-group">
                <label>üë• Integrantes que participan (alumno/a)</label>
                <input type="text"
                       th:field="*{paso5DTO.anexo4.integrantesalumno}"
                       placeholder="Alumno/a, orientador/a, tutor/a‚Ä¶"
                       required>
            </div>

            <div class="field-group fecha-group">
                <label>üìÖ Fecha de la entrevista con el alumno/a</label>
                <input type="date"
                       th:field="*{paso5DTO.anexo4.fechaalumno}"
                       required>
            </div>
        </div>


        <div class="section">
            <h2>PASO 5 <span class="paso-badge">Anexo V ‚Äì Se√±ales de Alarma</span></h2>

            <table style="width:100%; border-collapse: collapse;">
                <thead>
                <tr style="background:#eee;">
                    <th style="padding:10px; text-align:left;">Se√±al de alarma</th>
                    <th style="padding:10px; text-align:center;">S√≠</th>
                    <th style="padding:10px; text-align:center;">No</th>
                </tr>
                </thead>

                <tbody>

                <!-- SE√ëALES VERBALES -->
                <tr>
                    <td>Expresa deseo de morir</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.expresaDeseoMorir}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.expresaDeseoMorir}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Amenazas verbales</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.amenazasVerbales}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.amenazasVerbales}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Comentarios de culpa o inutilidad</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.comentariosCulpaInutilidad}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.comentariosCulpaInutilidad}"
                               th:value="false"/>
                    </td>
                </tr>

                <!-- SE√ëALES CONDUCTUALES -->
                <tr>
                    <td>Aislamiento social</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.aislamientoSocial}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.aislamientoSocial}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Conductas autolesivas</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.conductasAutolesivas}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.conductasAutolesivas}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Cambios bruscos de conducta</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.cambiosBruscosConducta}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.cambiosBruscosConducta}"
                               th:value="false"/>
                    </td>
                </tr>

                <!-- SE√ëALES EMOCIONALES -->
                <tr>
                    <td>Tristeza intensa</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.tristezaIntensa}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.tristezaIntensa}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Ansiedad</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.ansiedad}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.ansiedad}"
                               th:value="false"/>
                    </td>
                </tr>

                <tr>
                    <td>Desesperanza</td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.desesperanza}"
                               th:value="true"/>
                    </td>
                    <td style="text-align:center">
                        <input type="radio"
                               th:field="*{paso5DTO.anexo5.desesperanza}"
                               th:value="false"/>
                    </td>
                </tr>

                </tbody>
            </table>

            <!-- OBSERVACIONES -->
            <div class="field-group" style="margin-top:20px;">
                <label>üìù Observaciones</label>
                <textarea th:field="*{paso5DTO.anexo5.observaciones}"
                          placeholder="Observaciones adicionales‚Ä¶"></textarea>
            </div>

            <!-- FECHA -->
            <div class="field-group fecha-group">
                <label>üìÖ Fecha de detecci√≥n</label>
                <input type="date"
                       th:field="*{paso5DTO.anexo5.fechaDeteccion}">
            </div>

        </div>

        <!--
                                           <div class="section">
                                               <h2>PASO 6 <span class="paso-badge">Anexo VI</span></h2>

                                               <div class="field-group">
                                                   <strong>Director/a traslada informaci√≥n a Inspecci√≥n</strong>
                                                   <input type="text" th:field="*{paso6_1}" placeholder="Traslado a Inspecci√≥n">
                                               </div>

                                               <div class="field-group">
                                                   <strong>Director/a traslada informaci√≥n a la CPAyC</strong>
                                                   <input type="text" th:field="*{paso6_2}" placeholder="Traslado a CPAyC">
                                               </div>

                                               <div class="field-group">
                                                   <strong>EA: toma de decisiones ‚Äì Anexo VI</strong>
                                                   <input type="text" th:field="*{paso6_3}" placeholder="Decisiones tomadas por el EA">
                                               </div>
                                           </div>
        -->
        <div class="section">


            <h2>PASO 7 <span class="paso-badge">Anexo VII</span></h2>
            <div class="field-group">
                <strong>EA: Elaboraci√≥n del Plan Individualizado ‚Äì Anexo VII</strong>
                <input type="text" th:field="*{paso7_1}" placeholder="Plan Individualizado">
            </div>
        </div>

        <div class="section">
            <h2>PASO 8 <span class="paso-badge">Anexo VIII</span></h2>
            <div class="field-group">
                <strong>Responsable de Direcci√≥n:</strong>
                <input type="text" th:field="*{paso8DTO.responsableDireccion}"
                       placeholder="Nombre del responsable de direcci√≥n">
            </div>
            <div class="field-group">
                <strong>Otras medidas:</strong>
                <textarea th:field="*{paso8DTO.otrasMedidas}"
                          placeholder="Describe otras medidas del plan de seguimiento" rows="4"></textarea>
            </div>
        </div>

        <div class="section">
            <h2>PASO 9</h2>
            <div class="field-group">
                <strong>Director/a informa a familias del Plan</strong>
                <input type="text" th:field="*{paso9_1}" placeholder="Informaci√≥n del Plan a familias">
            </div>
        </div>

        <div class="section">
            <h2>PASO 10</h2>
            <div class="field-group">
                <strong>Seguimiento por parte de Inspecci√≥n</strong>
                <input type="text" th:field="*{paso10_1}" placeholder="Seguimiento de Inspecci√≥n">
            </div>
        </div>
        <!--
                                   <div class="section paso-11">
                                       <h2>PASO 11 ‚Äì Cierre</h2>

                                       <div class="field-group">
                                           <strong>Director/a realiza acta de cierre</strong>
                                           <input type="text" th:field="*{paso11_1}" placeholder="Acta de cierre">
                                       </div>

                                       <div class="field-group">
                                           <strong>Se informa a Inspecci√≥n</strong>
                                           <input type="text" th:field="*{paso11_2}" placeholder="Confirmaci√≥n a Inspecci√≥n">
                                       </div>

                                       <div class="field-group">
                                           <strong>Se informa a familia</strong>
                                           <input type="text" th:field="*{paso11_3}" placeholder="Confirmaci√≥n a familia">
                                       </div>

                                       <div class="field-group">
                                           <strong>Se informa a profesorado</strong>
                                           <input type="text" th:field="*{paso11_4}" placeholder="Confirmaci√≥n a profesorado">
                                       </div>
                                   </div>

                           -->
        <div class="section observations">
            <h2> Otras acciones / Observaciones</h2>
            <div class="field-group">
                <textarea th:field="*{observaciones}"
                          placeholder="Escriba aqu√≠ cualquier observaci√≥n adicional o acci√≥n relevante..."></textarea>
            </div>
        </div>

        <!-- BOTONES -->
        <div class="button-group">
            <button type="submit">üíæ Guardar Registro</button>
            <a href="/alumnado/listar" class="btn-back">‚Ü©Ô∏è Volver al Listado</a>
        </div>
    </form>
</div>

</body>
</html>