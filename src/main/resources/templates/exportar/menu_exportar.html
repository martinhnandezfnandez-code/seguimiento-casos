<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportar Informes - PCCS</title>
    <link rel="stylesheet" th:href="@{/css/exportar.css}">
</head>
<body>
<div class="container">
    <!-- Logo y Header -->
    <div class="top-banner">
        <div class="logo-section">
            <img src="/images/virgen-del-carmen_512.webp" alt="Logo" class="logo" width="130px">
        </div>
        <div class="header-content">
            <h1> Exportar Documentaci√≥n</h1>
            <p class="subtitle">Sistema de Prevenci√≥n de Conductas de Riesgo</p>
        </div>
    </div>

    <!-- Formulario de exportaci√≥n -->
    <div class="form-export">
        <div class="form-section">
            <div class="input-group">
                <label for="alumnoSelect">
                    <span class="label-icon">üë§</span>
                    Seleccionar Alumno
                </label>
                <div class="select-wrapper">
                    <select id="alumnoSelect" required>
                        <option value="">-- Selecciona un alumno --</option>
                        <option th:each="al : ${alumnos}"
                                th:value="${al.id}"
                                th:text="${al.codigoAlumno}">Alumno</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="pasoSelect">
                    <span class="label-icon">üìã</span>
                    Seleccionar Documento
                </label>
                <div class="select-wrapper">
                    <select id="pasoSelect" required>
                        <option value="">-- Selecciona un documento --</option>
                        <option value="1">Anexo 1 - Modelo Registro</option>
                        <option value="2">Anexo 2 - Cronograma de actuaci√≥n</option>
                        <option value="3">Anexo 3 - Acta de reunion con familiares</option>
                        <option value="4">Anexo 4 - Sintesis entrevistas</option>
                        <option value="5">Anexo 5 - Ficha an√†lisis</option>
                        <option value="6">Anexo 6 - Resoluci√≥n de toma de decisiones</option>
                        <option value="7">Anexo 7 - Plan individualizado de prevenci√≥n y protecci√≥n</option>
                        <option value="8">Anexo 8 - Plan de seguimiento</option>


                    </select>
                </div>
            </div>

            <div class="info-box">
                <span class="info-icon">‚ÑπÔ∏è</span>
                <p>Los documentos se generar√°n en formato PDF listo para imprimir o compartir.</p>
            </div>

            <button type="button" class="btn-generate" onclick="generarPDF()">
                <span class="btn-icon">üì•</span>
                Generar PDF
            </button>

            <a href="/admin/menu" class="btn-back">
                <span class="back-icon">‚Üê</span>
                Volver al men√∫ principal
            </a>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-info">
        <p>¬© 2026 Sistema de Seguimiento de Casos - Orientaci√≥n Educativa</p>
    </div>
</div>

<script>
    function generarPDF() {
    const alumnoId = document.getElementById('alumnoSelect').value;
    const pasoId = document.getElementById('pasoSelect').value;

    // Validaciones
    if (!alumnoId) {
        mostrarAlerta("Por favor, selecciona un alumno", "warning");
        return;
    }

    if (!pasoId) {
        mostrarAlerta("Por favor, selecciona un documento", "warning");
        return;
    }

    // 1. Guardar el contenido original y preparar el bot√≥n
    const btn = document.querySelector('.btn-generate');
    const originalContent = btn.innerHTML;

    btn.innerHTML = '<span class="loader"></span> Generando PDF...';
    btn.disabled = true;

    // 2. Ejecutar la l√≥gica de redirecci√≥n
    setTimeout(() => {
        let error = false;

        if (pasoId === "1") {
            window.location.href = '/alumnado/pdf/paso1/' + alumnoId;
        } else if (pasoId === "2") {
            window.location.href = '/alumnado/pdf/paso2/' + alumnoId;
        } else if (pasoId === "3") {
            window.location.href = '/alumnado/pdf/paso4/' + alumnoId;
        } else if (pasoId === "4") {
            window.location.href = '/alumnado/pdf/paso5_anexo4/' + alumnoId;
        } else if (pasoId === "5") {
            window.location.href = '/alumnado/pdf/paso5_anexo5/' + alumnoId;
        } else if (pasoId === "6") {
            window.location.href = '/alumnado/pdf/paso6/' + alumnoId;
        }  else if (pasoId === "7") {
            window.location.href = '/alumnado/pdf/paso7/' + alumnoId;
        } else if (pasoId === "8") {
            window.location.href = '/alumnado/pdf/paso8/' + alumnoId;
        } else {
            mostrarAlerta("El PDF para este paso a√∫n no est√° implementado", "info");
            error = true;
        }

        // 3. REHABILITAR EL BOT√ìN
        // Si hubo error o si fue una descarga (location.href), esperamos 2-3 segundos
        // para que el usuario vea que "algo pas√≥" y luego restauramos el bot√≥n.
        setTimeout(() => {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }, 2000);

    }, 500);
}

    function mostrarAlerta(mensaje, tipo) {
        // Sistema de alertas simple
        const alerta = document.createElement('div');
        alerta.className = `alerta alerta-${tipo}`;
        alerta.textContent = mensaje;
        document.body.appendChild(alerta);

        setTimeout(() => {
            alerta.classList.add('show');
        }, 10);

        setTimeout(() => {
            alerta.classList.remove('show');
            setTimeout(() => alerta.remove(), 300);
        }, 3000);
    }

    // Animaci√≥n al cargar
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('.form-export').classList.add('loaded');
    });
</script>
</body>
</html>